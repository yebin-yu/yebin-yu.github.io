
# 1 关于消息中间件

## 1.1 什么是消息中间件

消息中间件是指在分布式系统中完成消息的发送和接收的基础软件。
消息中间件也可以称消息队列（Message Queue / MQ），用高效可靠的消息传递机制进行与平台无关的数据交流，并基于数据通信来进行分布式系统的集成。通过提供消息传递和消息队列模型，可以在分布式环境下扩展进程的通信。
简而言之，互联网场景中经常使用消息中间件进行消息路由、订阅发布、异步处理等操作，来缓解系统的压力。



## 1.2 它解决了我们哪些痛点？

1、**解耦：** 比如说系统A会交给系统B去处理一些事情，但是A不想直接跟B有关联，避免耦合太强，就可以通过在A，B中间加入消息队列，A将要任务的事情交给消息队列 ,B订阅消息队列来执行任务。

> 这种场景很常见，比如A是订单系统，B是库存系统，可以通过消息队列把削减库存的工作交予B系统去处理。如果A系统同时想让B、C、D...多个系统处理问题的时候，这种优势就更加明显了。

![image](https://img2022.cnblogs.com/blog/167509/202204/167509-20220403151445587-1247122330.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/688)

2、**有序性：** 先进先出原理，先来先处理，比如一个系统处理某件事需要很长一段时间，但是在处理这件事情时候，有其他人也发出了请求，可以把请求放在消息队里，一个一个来处理。

> 对数据的顺序性和一致性有强需求的业务，比如同一张银行卡同时被多个入口使用，需要保证入账出账的顺序性，避免出现数据不一致。

![image](https://img2022.cnblogs.com/blog/167509/202204/167509-20220403152229902-463184452.png)

3、**消息路由：** 按照不同的规则，将队列中消息发送到不同的其他队列中

> 通过消息队列将不同染色的请求发送到不同的服务去操作。这样达成了流量按照业务拆分的目的。

4、**异步处理：** 处理一项任务的时候，有3个步骤A、B、C，需要先完成A操作, 然后做B、C 操作。任务执行成功与否强依赖A的结果，但不依赖B、C 的结果。
如果我们使用串行的执行方式，那处理任务的周期就会变长，系统的整体吞吐能力也会降低（在同一个系统中做异步其实也是比较大的开销），所以使用消息队列是比较好的办法。

> 登录操作就是典型的场景：A：执行登录并得到结果、B：记录登录日志、C：将用户信息和Token写入缓存。 执行完A就可以从登录页跳到首页了，B、C让服务慢慢去消化，不阻塞当前操作。

![image](https://img2022.cnblogs.com/blog/167509/202204/167509-20220403152938036-1318862151.png)

5、**削峰：** 将峰值期间的操作削减，比如A同学的整个操作流程包含12个步骤，后续的11个步骤是不需要强关注结果的数据，可以放在消息队列中。





参考

https://www.cnblogs.com/wzh2010/p/15888498.html



协议

本文 [1 关于消息中间件](#1 关于消息中间件) (无修改)来自 [MQ系列1：消息中间件执行原理](https://www.cnblogs.com/wzh2010/p/15888498.html)，以 `CC BY 4.0` 协议授权
